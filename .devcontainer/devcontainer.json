{
    "name": "RCS Simulation Environment (WSL GUI)",
    "build": {
        "dockerfile": "Dockerfile",
        "args": {
            "USERNAME": "vscode",
            "USER_UID": "1000",
            "USER_GID": "1000"
        }
    },

    "runArgs": [
        "--net=host"
    ],

    "mounts": [
        // X11 socket for legacy X11 apps
        "source=/tmp/.X11-unix,target=/tmp/.X11-unix,type=bind",
        // WSLg runtime dir — provides Wayland, PulseAudio, and the X11 socket on WSL2
        "source=/mnt/wslg,target=/mnt/wslg,type=bind",
        // SSH keys — mounts the host .ssh directory read-only so git over SSH works.
        // ${localEnv:HOME} resolves on Linux/WSL; ${localEnv:USERPROFILE} on Windows;
        // one will be empty so the concatenation always gives the right path.
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.ssh,target=/home/vscode/.ssh,readonly,type=bind,consistency=cached"
    ],

    // Display / audio env vars — hardcoded to WSLg defaults (works out of the box on WSL2)
    "containerEnv": {
        "DISPLAY": ":0",
        "WAYLAND_DISPLAY": "wayland-0",
        "XDG_RUNTIME_DIR": "/mnt/wslg/runtime-dir",
        "PULSE_SERVER": "/mnt/wslg/PulseServer"
    },

    // SSH agent socket passed through from host shell
    "remoteEnv": {
        "SSH_AUTH_SOCK": "${localEnv:SSH_AUTH_SOCK}",
        // openEMS paths (set permanently in ~/.bashrc by post-create, but also
        // needed here for non-interactive VS Code terminal sessions)
        "PATH": "/home/vscode/opt/openEMS/bin:${containerEnv:PATH}",
        "LD_LIBRARY_PATH": "/home/vscode/opt/openEMS/lib:${containerEnv:LD_LIBRARY_PATH}"
    },

    // Builds openEMS from source and writes the bypassPermissions Claude config
    "postCreateCommand": "bash .devcontainer/post-create.sh",

    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-python.vscode-pylance",
                "ms-python.debugpy",
                "njpwerner.autodocstring"
            ],
            "settings": {
                "python.defaultInterpreterPath": "/usr/bin/python3",
                "terminal.integrated.defaultProfile.linux": "bash"
            }
        }
    },

    "remoteUser": "vscode"
}
